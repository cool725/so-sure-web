{{ form_start(purchase_form, {'attr': {
    'data-toggle': 'validator',
    'class': 'validate-form form-400',
    'data-client-validation': form_client_validation,
    'autocomplete': 'off'
}}) }}

    {% include 'AppBundle::Purchase/_purchaseStepsRebrand.html.twig' %}

    <div class="form-group payment-options {% if form_errors(purchase_form.amount) %}has-error{% endif %}">
        <h4 class="payment-options__title text-dodger-blue mb-4">How would you like to pay?</h4>
        <div class="radio-btn-original">
            {{ form_label(purchase_form.amount, 'Payment options') }}
            {{ form_widget(purchase_form.amount) }}
        </div>
        <div class="radio-btn-group">
            <div class="row">
                {% if app.user.allowedMonthlyPayments %}
                    <div class="col-6">
                        <div class="radio-btn {% if purchase_form.vars.value.amount == phone.currentPhonePrice.monthlyPremiumPrice %}radio-btn-active{% endif %}" data-value="{{ phone.currentPhonePrice.monthlyPremiumPrice|number_format(2, '.', ',') }}" data-premium-type="month">
                            <div class="radio-btn__content">
                                <h6 class="radio-btn__title mb-0">Monthly</h6>
                                <div class="radio-btn__price">&pound;{{ phone.currentPhonePrice.monthlyPremiumPrice(app.user.additionalPremium)|number_format(2, '.', ',') }}</div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% if app.user.allowedYearlyPayments %}
                    <div class="col-6">
                        <div class="radio-btn {% if purchase_form.vars.value.amount == phone.currentPhonePrice.yearlyPremiumPrice(app.user.additionalPremium) %}radio-btn-active{% endif %}" data-value="{{ phone.currentPhonePrice.yearlyPremiumPrice|number_format(2, '.', ',') }}" data-premium-type="year">
                            <div class="radio-btn__content">
                                <h6 class="radio-btn__title mb-0">Yearly</h6>
                                <div class="radio-btn__price">&pound;{{ phone.currentPhonePrice.yearlyPremiumPrice(app.user.additionalPremium)|number_format(2, '.', ',') }}</div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="with-errors">{{ form_errors(purchase_form.amount) }}</div>
    </div>

    <div class="form-group mt-5">
        <div class="form-row">
            <div class="col-3">
                <a href="{{ path('purchase_step_pledge_id', {'id': policy.id}) }}"
                   class="btn btn-outline-grey btn-circle d-flex justify-content-center align-items-center">
                    <span class="sr-only">back</span>
                    <i class="far fa-arrow-left"></i>
                </a>
            </div>
            <div class="col-9 text-right">
                {% if purchase_form.existing is defined %}
                    {% do purchase_form.existing.setRendered %}
                {% endif %}
                {{ form_widget(purchase_form.next, {
                    'label': 'Proceed to payment',
                    'fa': 'far fa-long-arrow-right fa-lg ml-2',
                    'right': true,
                    'attr': {
                        'class': 'btn btn-success btn-green-gradient btn-block-xs'
                }}) }}
            </div>
        </div>
    </div>

    {% if payment_provider == 'judo' %}
        <div class="form-group text-center mt-5">
            <small class="text-grey">Payments powered by</small><br>
            <img src="{{ cdn_url }}/images/purchase/judo_pay_logo.svg" alt="Judo Pay" title="Powered by - Judo Pay" width="80px" class="mt-2">
        </div>
    {% elseif payment_provider == 'bacs' %}
        <div class="form-group text-center mt-5">
            <small class="text-grey">Payments via</small><br>
            <img src="{{ cdn_url }}/images/rebrand/misc/so-sure_direct-debit-logo.svg" alt="Direct Debit" width="100px" class="mt-2">
        </div>
    {% endif %}

{{ form_end(purchase_form) }}

<form action="{{ webpay_action }}" method="post" id="webpay-form">
    <input id="Reference" name="Reference" type="hidden" value="{{ webpay_reference }}">
</form>

<div id="so-sure-loader" class="loader">
    <div class="loader__inner d-flex align-items-center flex-column justify-content-center">
        <img src="{{ cdn_url }}/images/rebrand/misc/so-sure_loader.svg" alt="loading...">
        {% if payment_provider == 'judo' %}
            <small class="text-grey">Payments powered by</small><br>
            <img src="{{ cdn_url }}/images/purchase/judo_pay_logo.svg" alt="Judo Pay" title="Powered by - Judo Pay" width="80px">
        {% elseif payment_provider == 'bacs' %}
            <small class="text-grey">Payments via</small><br>
            <img src="{{ cdn_url }}/images/rebrand/misc/so-sure_direct-debit-logo.svg" alt="Direct Debit" width="100px">
        {% endif %}
    </div>
</div>
