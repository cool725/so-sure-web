{% extends "FOSUserBundle::layout.html.twig" %}
{% block fos_user_content %}
<h1>Welcome back!</h1>
{# Account Kit Login #}
<div id="login-account-kit" class="login-account-kit login-box" style="{% if default_login_method == 'email' %}display: none;{% endif %}" data-key="{{ fb_appid }}" data-csrf="{{ csrf_token('account-kit') }}" data-toggle="{% if app.request.clientIp == davies_ip %}1{% else %}0{% endif %}">
    <form method="get" action="https://www.accountkit.com/v1.0/basic/dialog/sms_login/" autocomplete="off">
    <p>If you click on Log In via SMS, a popup will appear.</p>
    <div class="form-group">
        <input type="hidden" value="+44" id="country_code" class="form-control" />
        <input type="hidden" name="app_id" value="{{ fb_appid }}">
        <input type="hidden" name="redirect" value="{{ app.request.schemeAndHttpHost }}/login/check-accountkit">
        <input type="hidden" name="state" value="{{ accountkit_state() }}">
        <input type="hidden" name="fbAppEventsEnabled" value=true>
        <input type="hidden" name="debug" value=false>
    </div>
    <div class="form-group">
        <input placeholder="Mobile number" id="phone_number" name="phone_number" class="form-control input-lg" type="tel" />
        <span class="help-block text-center"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> UK numbers only</span>
    </div>
    {% if error %}
        <div class="error-text" style="padding-bottom: 10px;">Sorry, we were unable to log you in. You can try again, or <a href="mailto:support@wearesosure.com" class="open-intercom">contact us</a> for help.</div>
    {% endif %}
    <div class="form-group">
          <button class="btn btn-success btn-block">
                <span id="btn-spinner" style="display:none;"><i class="fa fa-refresh fa-spin"></i></span>
                Login via SMS
            </button>
    </div>
    </form>
    <div id="sms-login__warning" class="form-group" style="display:none;">
        <div class="help-block">
            <small>There may be a small delay whilst we open a new window.<br><br></small>
        </div>
    </div>
</div>

{# Email Login #}
<div class="login-email login-box" style="{% if default_login_method == 'accountkit' %}display: none;{% endif %}">
    <p>Please login below.</p>
    <form class="" action="{{ path("fos_user_security_check") }}#email" method="post" autocomplete="off">
        <input type="hidden" name="_csrf_token" value="{{ csrf_token }}"/>
        <div class="form-group">
            <input type="email" id="username" name="_username" value="{{ last_username }}" required="required" placeholder="Email Address" class="form-control input-lg" />
        </div>
        <div class="form-group">
            <input type="password" id="password" name="_password" required="required" placeholder="Password" class="form-control input-lg" />
        </div>
        {% if error %}
            <div class="error-text" style="padding-bottom: 10px;">
                {% if app.request.clientIp == davies_ip or app.request.clientIp in sosure_ips %}
                    Looks like the email address or password you’ve entered is incorrect, or <strong>your password has expired</strong>. Please try again. You may want to <a href="{{ path('fos_user_resetting_request') }}">reset your password</a>.
                {% else %}
                    Looks like the email address or password you’ve entered is incorrect. Please try again. You may want to <a href="{{ path('fos_user_resetting_request') }}">reset your password</a>.
                {% endif %}
            </div>
        {% endif %}
        <div class="form-group">
            <input type="submit" id="_submit" name="_submit" value="Login" class="btn btn-success btn-block"/>
        </div>
        <div class="form-group">
            <small><a class="btn btn-link btn-xs" href="{{ path('fos_user_resetting_request') }}">Forgot password?</a></small>
        </div>
        <div class="form-group">
            <label for="remember_me">
                <input type="checkbox" id="remember_me" name="_remember_me" value="on" {% if app.request.clientIp == davies_ip %}checked{% endif %} />
                Remember me
            </label>
        </div>
    </form>
</div>

<div class="login-box login-box--controls">
    <div class="swap-login-wrapper form-group">
        <a href="#" id="swap-login" class="btn btn-primary-hollow btn-block">Prefer <span>{% if default_login_method == 'accountkit' %}email{% else %}mobile{% endif %}</span> login?</a>
    </div>

    <div class="form-group">
        <a href="#" class="btn btn-facebook btn-facebook-login btn-block"><i class="fa fa-facebook-official"></i> &nbsp;Login with Facebook</a>
    </div>

    <div class="form-group">
        <a href="{{ path('hwi_oauth_service_redirect', {'service': 'google' }) }}"
           formnovalidate="formnovalidate"
           class="btn btn-google btn-block btn-pad"
            > &nbsp;Continue with Google
        </a>
    </div>

    {% if feature_enabled('starling') %}
    <div class="form-group">
        <a class="btn btn-block btn-starling" href="/login/starling"><img src="{{ cdn_url }}/images/StarlingMarkIcon.png" height="20px"> &nbsp;Login with Starling</a>
    </div>
    {% endif %}
</div>

<form id="accountkit-form" method="post" action="{{ path('accountkit_login') }}">
    <input type="hidden" id="accountkit-code" name="code">
    <input type="hidden" id="accountkit-csrf" name="csrf">
</form>

{% endblock fos_user_content %}

{% block javascripts %}
    {{ parent() }}
    {% javascripts
        'components/jquery-validation/jquery.validate.js'
        '../app/Resources/public/js/login.js'
    %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <script src="https://sdk.accountkit.com/en_US/sdk.js"></script>
{% endblock %}
