<!DOCTYPE html>
<html lang="en">
    <head>
        <title>
            {% block title %}so-sure{% endblock %}
        </title>
        {% block meta %}{% endblock %}

        {% include '::header.html.twig' %}

        {% block stylesheets %}
            {# Whilst we are transitioning use two different main stylesheets #}
            {% if new_stylesheet is defined and new_stylesheet == 1 %}
                {% stylesheets output='css/*.css'
                    '@AppBundle/Resources/public/sass/mainNew.scss'
                %}
                <link rel="stylesheet" href="{{ asset_url }}">
                {% endstylesheets %}
            {% else %}
                {% stylesheets output='css/*.css'
                    '@AppBundle/Resources/public/sass/main.scss'
                %}
                <link rel="stylesheet" href="{{ asset_url }}">
                {% endstylesheets %}
            {% endif %}
        {% endblock %}

        {% block remotestylesheets %}
        {% endblock %}
        {% block metaend %}{% endblock %}
    </head>
    <body {% if distraction_free is defined and distraction_free == 1 %}class="distraction-free"{% endif %}>

        {# Google Tag Manager Data Layer #}

        {# Intercom #}
        <script>
            {% if intercom_enabled is not defined %}
                {% set intercom_enabled = true %}
            {% endif %}
            {% if app is not null and app.session.isStarted %}
                {% set session_referral = app.session.get('referral') %}
                {% set session_scode = app.session.get('scode') %}
                {% set session_quote_url = app.session.get('quote_url') %}
            {% else %}
                {% set session_referral = '' %}
                {% set session_scode = '' %}
                {% set session_quote_url = '' %}
            {% endif %}
            dataLayer = [{
                {% if (app is not defined or app is null) or
                    ( (app.user is not defined or app.user is null or not app.user) or
                      (app.session.isStarted and is_granted('ROLE_PREVIOUS_ADMIN'))
                    )
                %}
                    'branch': {
                        'banner': true,
                        'referral': '{{ session_referral }}',
                        'scode': '{{ session_scode }}'
                    },
                    'user': {
                        'id': undefined,
                    },
                    'intercom': {
                        'user_id': null,
                        'user_hash': null,
                        'email': null,
                        'name':  null,
                        'created_at': null,
                        'quote_url': '{{ session_quote_url }}',
                        'enabled': {% if intercom_enabled %}true{% else %}false{% endif %}
                    }
                {% else %}
                    'branch': {
                        'banner': false,
                        'referral': '{{ session_referral }}',
                        'scode': '{{ session_scode }}'
                    },
                    'user': {
                        'id': '{{ app.user.id }}'
                    },
                    'intercom': {
                        'user_id': '{{ app.user.id }}',
                        'user_hash': '{{ intercom(app.user) }}',
                        'email': '{{ app.user.email }}',
                        'name': '{{ app.user.name }}',
                        'created_at': '{{ app.user.created|date('U') }}',
                        'quote_url': '{{ session_quote_url }}',
                        'enabled': {% if intercom_enabled %}true{% else %}false{% endif %}
                    }
                {% endif %}
                {% block gtm_data %}{% endblock %}
            }];
        </script>

        {% if exclude_remote_scripts is not defined or not exclude_remote_scripts %}

            {# Google Tag Manager #}
            {# NOTE: This code is modifed from the original to pass in environment tags #}
            <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-KGBBJQ{{ ga_tag_manager_env|raw }}"
            height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
            <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl+'{{ ga_tag_manager_env|raw }}';f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','GTM-KGBBJQ');</script>
            {# End Google Tag Manager #}

        {% endif %}

        {% if environment != 'prod' %}
            <nav class="navbar navbar-fixed-bottom" style="background-color:#EFEFEF;height:40px;">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <ul class="navbar-brand list-inline">
                            <li><strong class="text-red">{{ environment }}</strong></li>
                            <li><a href="{{ path('ops_pages') }}"><i class="fa fa-wrench fa-lg"></i></a></li>
                            <li><a href="{{ path('quote_make_model_memory', {'make':'Apple','model':'iPhone 7','memory':128}) }}"><i class="fa fa-mobile fa-lg" title="Quick Quote"></i></a></li>
                            <li><a href="#" onclick="window.location.reload(true);"><i class="fa fa-refresh fa-lg" aria-hidden="true"></i></a></li>
                            {% if distraction_free is defined and distraction_free == 1 and app.user is not null and app.user %}
                                {% if is_granted('ROLE_PREVIOUS_ADMIN') %}
                                    <li><a href="{{ path('homepage', {'_impersonate': '_exit'}) }}">Exit <strong>{{ app.user.email }}</strong></a></li>
                                {% else %}
                                    <li><a href="{{ path('fos_user_security_logout') }}">Logout <strong>{{ app.user.email }}</strong></a></li>
                                {% endif %}
                            {% endif %}
                        </ul>

                    </div>
                </div>
            </nav>
        {% endif %}

        {% block nav %}
            {% if new_stylesheet is defined and new_stylesheet == 1 %}
                {% include '::nav_new.html.twig' %}
            {% else %}
                {% include '::nav.html.twig' %}
            {% endif %}
        {% endblock %}

        {% if app.session.isStarted %}
            {% if app.session.flashBag.peekAll | length > 0 %}
                <div class="container text-center flash-container">
                    {% for flash_message in app.session.flashBag.get('success') %}
                        <div class="bg-success flash-success flash">
                            <h4>{{ flash_message|raw }}</h4>
                        </div>
                    {% endfor %}
                    {% for flash_message in app.session.flashBag.get('warning') %}
                        <div class="bg-warning flash-warning flash">
                            <h4>{{ flash_message|raw }}</h4>
                        </div>
                    {% endfor %}
                    {% for flash_message in app.session.flashBag.get('error') %}
                        <div class="bg-danger flash-danger flash">
                            <h4>{{ flash_message|raw }}</h4>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endif %}

        {% block body %}{% endblock %}

        {% block footer %}
            {% if new_footer is defined and new_footer == 1 %}
                {% include '::footer_new.html.twig' %}
            {% else %}
                {% include '::footer.html.twig' %}
            {% endif %}
        {% endblock %}

        {% if use_cdn %}
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        {% else %}
            <script src="/components/jquery/jquery.min.js"></script>
            <script src="/components/bootstrap-sass/bootstrap.js"></script>
        {% endif %}

        {% block javascripts %}
            {% if hide_cookie_warning is defined and hide_cookie_warning %}
                {% javascripts
                '@AppBundle/Resources/public/js/*' %}
                <script src="{{ asset_url }}"></script>
                {% endjavascripts %}
            {% else %}
                {% javascripts
                'components/cookieconsent/cookieconsent.min.js'
                '@AppBundle/Resources/public/js/*' %}
                <script src="{{ asset_url }}"></script>
                {% endjavascripts %}
            {% endif %}
        {% endblock %}
    </body>
</html>
