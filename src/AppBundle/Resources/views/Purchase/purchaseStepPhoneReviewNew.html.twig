{% form_theme purchase_form 'AppBundle:Form:fields.html.twig' %}
{% extends 'base.html.twig' %}

{# Set vars #}
{% set new_stylesheet = 1 %}
{% set distraction_free = 1 %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets output='css/*.css'
        'components/bootstrap-daterangepicker/daterangepicker.css'
        'components/intl-tel-input/intlTelInput.css'
        '@AppBundle/Resources/public/sass/page/checkoutNew.scss'
    %}
        <link rel="stylesheet" href="{{ asset_url }}">
    {% endstylesheets %}
{% endblock %}

{% block body %}

<section id="purchase-step-review" class="checkout">

    {% include 'AppBundle::Purchase/purchaseNavNew.html.twig' %}

    <div class="checkout--top">
        <div class="container">
            <h1>
                <span class="title-top-all">Cover details</span>
                <br>
                <span class="title-phone text-blue text-nowrap"
                      data-toggle="modal"
                      data-target="#quoteModel"
                      title="Change phone">{{ phone.make }} {{ phone.model }}
                {% if phone.memory %}
                    {{ phone.memory }}GB</span>
                {% endif %}
                </span>
            </h1>
            <ul class="list-unstyled benefits--review-mobile visible-xs">
                <li class="h4">
                    <i class="fa fa-check text-green" aria-hidden="true"></i> Loss</li>
                <li class="h4">
                    <i class="fa fa-check text-green" aria-hidden="true"></i> Theft</li>
                <li class="h4"><i class="fa fa-check text-green" aria-hidden="true"></i> Accidental damage</li>
                <li class="h4"><i class="fa fa-check text-green" aria-hidden="true"></i> Out of warranty breakdown</li>
                <li class="h4"><i class="fa fa-check text-green" aria-hidden="true"></i> Worldwide coverage</li>
            </ul>
            <div class="benefits--review-desktop hidden-xs">
                <div class="benefits--inner">
                    <div class="row">
                        <div class="col-sm-6">
                            <img src="{{ cdn_url }}/images/library_benefits/so-sure_cover-loss.svg" alt="Loss" title="Loss">
                            <h4>Loss</h4>
                            <p>Including unauthorised use &amp; accessories</p>
                        </div>
                        <div class="col-sm-6">
                            <img src="{{ cdn_url }}/images/library_benefits/so-sure_cover-theft.svg" alt="Theft" title="Theft">
                            <h4>Theft</h4>
                            <p>Including unauthorised use &amp; accessories</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <img src="{{ cdn_url }}/images/library_benefits/so-sure_cover-water-damage.svg" alt="Accidental Damage" title="Accidental damage">
                            <h4>Accidental damage</h4>
                            <p>Including cracked screen &amp; water damage</p>
                        </div>
                        <div class="col-sm-6">
                            <img src="{{ cdn_url }}/images/library_benefits/so-sure_cover-breakdown.svg" alt="Out of warranty breakdown" title="Out of warranty breakdown">
                            <h4>Out of warranty breakdown</h4>
                            <p>Some text.....</p>
                        </div>
                    </div>
                    <h4 class="text-center">All this including worldwide cover for 90 days</h4>
                </div>
            </div>
        </div>
    </div>

    <div class="payment--step">
        <div class="payment--step-inner clearfix">
            <h4>How would you like to pay?<br>
            <small>(Select an option below)</small></h4>
            <div class="payment--btn {% if purchase_form.vars.value.amount == phone.currentPhonePrice.monthlyPremiumPrice %}payment--btn-selected{% endif %}" id="payment--monthly" data-target="#purchase_form_amount_0">
                <span class="billed visible-xs">Monthly <br></span>
                <span class="amount">Â£{{ phone.currentPhonePrice.monthlyPremiumPrice|number_format(2, '.', ',') }}
                <span class="hidden-xs">a month</span><br></span>
                <small class="visible-xs">Billed 2nd of each month</small>
                <small class="hidden-xs">You will be billed the 2nd of each month</small>
            </div>
            <div class="payment--btn-or">
                OR
            </div>
            <div class="payment--btn{% if purchase_form.vars.value.amount == phone.currentPhonePrice.yearlyPremiumPrice %}payment--btn-selected{% endif %}" id="payment--yearly" data-target="#purchase_form_amount_1">
                <span class="billed visible-xs">Yearly <br></span>
                <span class="amount">Â£{{ phone.currentPhonePrice.yearlyPremiumPrice|number_format(2, '.', ',') }}
                <span class="hidden-xs">a year</span><br></span>
                <small class="visible-xs">Billed on date of purchase</small>
                <small class="hidden-xs">You will be billed for the year on purchase</small>
            </div>
        </div>
    </div>
    <div class="checkout--step">
        <div class="container">

            {{ form_start(purchase_form, {'attr': {'data-toggle': 'validator', 'class': 'validate-form'}}) }}
                <div class="form-group payment-options {% if form_errors(purchase_form.amount) %}has-error{% endif %}">
                    {{ form_label(purchase_form.amount, 'Payment Options:', { 'label_attr': {'class': 'sr-only'} }) }}
                    {{ form_widget(purchase_form.amount) }}
                    <div class="help-block with-errors">{{ form_errors(purchase_form.amount) }}</div>
                    <div class="help-block with-errors">{{ form_errors(purchase_form.imei) }}</div>
                </div>
                <div class="form-group {% if form_errors(purchase_form.imei) %}has-error{% endif %}">
                    {{ form_label(purchase_form.imei, 'IMEI Number:', { 'label_attr': {'class': 'sr-only'} }) }}
                    {{ form_widget(purchase_form.imei, {'attr':{'class':'form-control', 'placeholder':'IMEI Number'}}) }}
                    <span class="help-block text-center">
                        <a href="#"
                           class="text-underline"
                           data-toggle="modal"
                           data-target="{% if purchase_form.serialNumber is defined %}#appleModal{% else %}#nonAppleModal{% endif %}"
                           >Dial *#06# to show your IMEI number.</a>
                    </span>
                </div>

                <div class="form-group">
                    <div class="text-break text-grey">
                        <div class="line"></div>OR<div class="line"></div>
                    </div>
                </div>

                <div class="form-group">
                    <a href="#"
                       class="btn btn-blue btn-block btn-pad"
                       onclick="sosuretrack('Clicked Upload Imei');Intercom('trackEvent', 'clicked upload imei');Intercom('showNewMessage', 'Hi, I want to take a screenshot of my IMEI number to send to you. Can you let me know what to do? ðŸ™‚')">Send us a screenshot of your IMEI</a><br>
                </div>
                {% if purchase_form.serialNumber is defined %}
                    <div class="form-group {% if form_errors(purchase_form.serialNumber) %}has-error{% endif %}">
                        {{ form_label(purchase_form.serialNumber, 'Serial Number:', { 'label_attr': {'class': 'sr-only'} }) }}
                        {{ form_widget(purchase_form.serialNumber, {'attr':{'class':'form-control',  'pattern': '[a-zA-Z0-9]{5,32}', 'title': 'Enter a valid serial number', 'placeholder':'Serial Number'}}) }}
                        <div class="help-block with-errors">{{ form_errors(purchase_form.serialNumber) }}</div>
                        <span class="help-block text-center">
                            <a href="#"
                               class="text-underline"
                               data-toggle="modal"
                               data-target="{% if purchase_form.serialNumber is defined %}#appleModal{% else %}#nonAppleModal{% endif %}">Go to Settings > General > About.</a>
                        </span>
                    </div>
                {% endif %}
                <div class="form-group">
                    <a href="#"
                       id="step--validate"
                       class="btn btn-green btn-block btn-pad">
                        Continue
                    </a>
                </div>
                <div class="modal modal-purchase fade"
                     id="reviewModal"
                     tabindex="-1"
                     role="dialog">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h3 class="modal-title text-blue">Before you proceed! <br>Please confirm the following are correct:</h3>
                            </div>
                            <div class="modal-body">
                                <ol>
                                    <li>My phone is in full working condition and my screen is not cracked.</li>
                                    <li>I am a resident of the United Kingdom.</li>
                                    <li>I have read &amp; understood the so-sure policy document.</li>
                                </ol>
                                <p>Please be advised that if you confirm that the above is true and we later discover that it isnâ€™t, your claim might get denied.</p>
                                <p class="text-center" style="display: none">{{ form_widget(purchase_form.agreed, {'label': ' I confirm the above is correct', 'value': 'checked'}) }}</p>
                                {% if app.user.hasValidPaymentMethod %}
                                    <div class="form-group">
                                        {{ form_widget(purchase_form.existing, {'label': 'Pay with card on file', 'attr': {'class': 'btn btn-green btn-block btn-pad'}}) }}
                                    </div>
                                {% else %}
                                    <div class="form-group">
                                        {{ form_widget(purchase_form.next, {'label': 'Continue to payment', 'attr': {'class': 'btn btn-green btn-block btn-pad'}}) }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

            {{ form_end(purchase_form) }}
            <form action="{{ webpay_action }}" method="post" id="webpay-form">
                <input id="Reference" name="Reference" type="hidden" value="{{ webpay_reference }}">
            </form>
        </div>
    </div>

</section>

{# Page Modals #}

{% include 'AppBundle::Default/modalQuote.html.twig' %}

<div class="modal modal-middle fade"
     id="appleModal"
     tabindex="-1"
     role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">IMEI &amp; Serial Numbers</h4>
            </div>
            <div class="modal-body">
                <p><strong>It's easy to find your IMEI number:</strong></p>
                <ul class="list-unstyled">
                    <li>
                        It's easy to find your IMEI &amp; Serial Numbers.  Open the Settings app, and navigate to <strong>General</strong> > <strong>About</strong>.  The Serial Number is listed about halfway down the screen and the IMEI is a few rows below that.
                    </li>
                    <br>
                    <li>
                        You can also log into your iTunes account and find the IMEI &amp; Serial Numbers display on the phone information screen.
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-middle fade"
     id="nonAppleModal"
     tabindex="-1"
     role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">IMEI Number</h4>
            </div>
            <div class="modal-body">
                <p><strong>It's easy to find your IMEI number:</strong></p>
                <ul class="list-unstyled">
                    <li>
                        Just dial <a href="tel:*#06#">*#06#</a> on your mobile and your IMEI will immediately be displayed.  There is no cost to dial this number.
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-fullscreen fade"
     id="policy-modal"
     tabindex="-1"
     role="dialog"
     aria-labelledby="So-Sure Policy Terms"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3>So-Sure Policy Terms</h3>
            </div>
            <div class="modal-body modal-policy">
                {{ render(controller('AppBundle:ApiView:policyLatestTerms', {'policy_key': policy_key, 'maxPotValue':  phone.getCurrentPhonePrice.maxPot })) }}
            </div>
        </div>
    </div>
</div>

{# End Page Modals #}

{% endblock %}

{% block footer %}
<!-- Analytics -->
    <div id="fb-root"></div>
    <div id="ss-root" data-fb-id="{{ fb_appid }}"
       data-fb-redirect="{{ url("hwi_oauth_service_redirect", {service: "facebook"}) }}"
       {% if use_pca is defined %}data-pca-key="{{ pca_webkey }}"{% endif %}
       ></div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% javascripts
    'components/moment/moment.min.js'
    'components/bootstrap-daterangepicker/daterangepicker.js'
    'components/typeahead.js/typeahead.bundle.min.js'
    'components/owl.carousel/owl.carousel.min.js'
    'components/fuse.js/fuse.min.js'
    'components/jquery-validation/jquery.validate.js'
    'components/intl-tel-input/intlTelInput.min.js'
    '@AppBundle/Resources/public/js/Default/selectPhoneMake.js'
    '@AppBundle/Resources/public/js/Default/index.js'
    '@AppBundle/Resources/public/js/Purchase/purchaseStepNew.js'
    '@AppBundle/Resources/public/js/Purchase/purchaseStepPhoneNew.js' %}
    <script src="{{ asset_url }}"></script>{% endjavascripts %}
{% endblock %}
