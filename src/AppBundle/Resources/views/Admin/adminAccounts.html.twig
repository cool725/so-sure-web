{% extends 'admin_claims_base.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    {% javascripts
        '@AppBundle/Resources/public/js/Admin/month.js'
        '@AppBundle/Resources/public/js/Admin/adminAccounts.js'
    %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block body %}
<div class="container" style="margin-bottom: 50px">

<div class="row">
    <div class="col-md-6">
        <h1>so-sure Accounts for {{ month }} / {{ year }}</h1>
    </div>
    <form class="month-form form-inline" method="POST" autocomplete="off">
    <div class="col-md-4">
        <div class="form-group" style="padding-top: 15px;">
            <div class="input-group date month" data-url="{{ path('admin_accounts') }}">
                <input name="accounts" type='text' class="form-control" value="{{month}}-{{year}}" />
                <span class="input-group-addon">
                    <span class="fa fa-calendar"></span>
                </span>
            </div>
            <div class="input-group">
                <div class="input-group-btn">
                    <button class="btn btn-success"><i class="fa fa-arrow-right"></i></button>
                </div>
            </div>
            <div class="input-group" style="margin-left: 10px;">
                <div class="input-group-btn">
                    {{ form_start(salvaForm) }}
                    <a class="btn btn-info" target="_blank" href="{{ path('admin_accounts_print', {'year': year, 'month': month}) }}" rel="noopener noreferrer">
                        &nbsp;<i class="fa fa-print"></i>&nbsp;
                    </a>
                    {{ form_widget(salvaForm.export, {'label': 'Salva', 'title': 'Re-export to Salva', 'attr': {'class': "btn btn-warning salva-export"}}) }}
                    {{ form_end(salvaForm) }}
                </div>
            </div>
        </div>
    </div>
    </form>
</div>

{% include 'AppBundle:Admin:adminAccountsData.html.twig' %}

    {% for file in files %}
        {% if file.fileType == 'SalvaPaymentFile' or file.fileType == 'SalvaPolicyFile' %}
        {% set filename = file.filename|split('.') %}
        {% set file_dates = filename[0]|split('-') %}
        {% set file_date = file_dates[file_dates|length - 1] %}
        <h3>{{ file.filename }} [From {{ file_date|date }}]</h3>
        <ul>
            {% for key, value in file.metadata %}
                <li>{{ key }}: {{ value }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    {% endfor %}

</div>
{% endblock %}
