{% extends 'admin_claims_base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets output='css/*.css'
    '@AppBundle/Resources/public/sass/page/admin.scss'
 %}<link rel="stylesheet" href="{{ asset_url }}">{% endstylesheets %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% javascripts
        '@AppBundle/Resources/public/js/Claims/claimsModal.js'
    %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block body %}
<div class="container">
    <div class="bg-info" style="border-radius: 10px; padding: 10px;">
    <h4 class="text-center"><strong>Claims</strong></h4>
    {{ form_start(form, {'attr': {'class': 'form-inline'}})  }}
        <div class="row">
            <div class="form-group col-sm-10">
                {{ form_label(form.status, 'Status', {'label_attr': {'class': 'col-sm-2'}}) }}
                {{ form_errors(form.status) }}
                {{ form_widget(form.status, {'attr': {'class': 'col-sm-10 claim-status'}}) }}
            </div>
        </div>
        <div class="row">
            <div class="form-group col-sm-5">
                {{ form_label(form.number, 'Claim Number', {'label_attr': {'class': 'col-sm-4'}}) }}
                {{ form_errors(form.number) }}
                {{ form_widget(form.number, {'attr': {'class': 'col-sm-3 claim-status'}}) }}
            </div>
            <div class="form-group col-sm-5">
                {{ form_label(form.id, 'Claim Id', {'label_attr': {'class': 'col-sm-3'}}) }}
                {{ form_errors(form.id) }}
                {{ form_widget(form.id, {'attr': {'class': 'col-sm-7 claim-status'}}) }}
            </div>
            <div class="form-group">
              <div class="col-sm-2 text-center">
                {{ form_widget(form.search, {'label': 'Search', 'attr': {'class': 'btn btn-success'}}) }}
              </div>
            </div>
        </div>
        {{ form_end(form) }}
  </div>
    {% if claims.count == 0 %}
    <div class="row-fluid">
        <h2>No claims found</h2>
    </div>
    {% else %}
    <div class="row-fluid">
        <div class="col-md-12">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Claim Number</th>
                        <th>Policy</th>
                        <th>Type</th>
                        <th>Claim Status</th>
                        <th>Policy Status</th>
                        <th>Notification Date</th>
                        <th>Approval Date</th>
                        <th>Replacement</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for claim in claims %}
                        <tr>
                            <td><button type="button" class="btn btn-link" data-toggle="modal" data-target="#claimsModal"
                            data-claim='{{ claim.toModalArray|json_encode }}'>
                                {% if claim.number %}{{ claim.number }}{% else %}N/A{% endif %}</button>
                            </td>
                            <td><a href="{{ path('admin_policy', {id: claim.policy.id}) }}">{{ claim.policy.policyNumber }}</a></td>
                            <td>{{ claim.type }}</td>
                            <td>{{ claim.status }}</td>
                            <td>{{ claim.policy.status }}</td>
                            <td>{{ claim.notificationDate|date('d-m-Y', 'Europe/London') }}</td>
                            <td class="{% if claim.approvedDate and claim.replacementReceivedDate and claim.approvedDate > claim.replacementReceivedDate %}danger{% endif %}">
                                {% if claim.approvedDate %}
                                    {{ claim.approvedDate|date('d-m-Y', 'Europe/London') }}</td>
                                {% else %}
                                    -
                                {% endif %}
                            <td>{% if claim.replacementReceivedDate %}
                                    {{ claim.replacementReceivedDate|date('d-m-Y', 'Europe/London') }}
                                {% else %}
                                    -
                                {% endif %}
                                {% if claim.replacementImei or claim.replacementReceivedDate %}
                                    {% if claim.replacementPhoneDetails %}
                                        {% if claim.replacementPhone%}<i class="fa fa-check" title="Davies: '{{ claim.replacementPhoneDetails }}' <==> so-sure: '{{ claim.replacementPhone }}'"></i>
                                        {% else %}<i class="fa fa-warning" title="{{ claim.replacementPhoneDetails }} recorded, but replacement phone not confirmed"></i>
                                        {% endif %}
                                    {% else %}
                                        <i class="fa fa-warning" title="IMEI has been updated, but no replacement phone details"></i>
                                    {% endif %}
                                {% endif %}
                                {% if claim.replacementPhone and claim.replacementPhone.id != claim.policy.phone.id %}
                                    <i class="fa fa-warning text-danger" title="Replacement phone does not match insured phone!"></i>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    </form>

    {% if claims.count > 0 %}
    <div class="pagerfanta">
        {{ pagerfanta(pager, 'twitter_bootstrap3') }}
    </div>
    {% endif %}

</div>

{% include 'AppBundle::Claims/claimsModal.html.twig' with {'route': 'admin_claims' } %}


{% endblock %}
