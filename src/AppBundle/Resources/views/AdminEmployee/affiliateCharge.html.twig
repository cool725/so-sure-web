{% extends 'admin_claims_base_rebrand.html.twig' %}

{# Set vars #}
{% if overview is defined  %}
    {% set page = 'overview' %}
{% elseif charges is defined %}
    {% set page = 'charges' %}
{% elseif pending is defined %}
    {% set page = 'pending' %}
{% elseif potential is defined %}
    {% set page = 'potential' %}
{% elseif lost is defined %}
    {% set page = 'lost' %}
{% endif %}

{% set body_class = 'admin-affiliates-' ~ page %}

{% block title %}so-sure - Affiliates {{ page }}{% endblock %}
{% block meta %}{% endblock %}

{% block cssPage %}
   {#  <link rel="stylesheet" href="{{ asset('css-js/homepage.css') }}"> #}
{% endblock %}

{% block body %}

    <section class="py-4 px-md-4">
        <div class="container-fluid">
            {# TODO: Heading area #}
            <div class="d-lg-flex align-items-lg-center justify-content-lg-between mb-3">
                {# Error Message #}
                {% if error is defined %}
                    <h1 class="h2">Error: {{ error }}</h1>
                {% else %}
                    <h1 class="h2">Affiliates</h1>
                {% endif %}
            </div>
            {% if error is not defined %}
                <ul class="nav nav-tabs" id="affiliate_tabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link {% if overview is defined %}active{% endif %}"
                           id="overview_tab"
                           {# data-toggle="tab" #}
                           href="{{ path('admin_affiliate_overview', {'id': affiliate.id}) }}"
                           role="tab"
                           aria-controls="overview"
                           aria-selected="{% if overview is defined %}true{% else %}false{% endif %}">Overview</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if charges is defined %}active{% endif %}"
                           id="monthly_charges_tab"
                           {# data-toggle="tab" #}
                           href="{{ path('admin_affiliate_charge', {'id': affiliate.id}) }}"
                           role="tab"
                           aria-controls="monthly_charges"
                           aria-selected="{% if charges is defined %}true{% else %}false{% endif %}">Monthly Charges</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if pending is defined %}active{% endif %}"
                           id="pending_aquisitions_tab"
                           {# data-toggle="tab" #}
                           href="{{ path('admin_affiliate_pending', {'id': affiliate.id}) }}"
                           role="tab"
                           aria-controls="pending_aquisitions"
                           aria-selected="{% if pending is defined %}true{% else %}false{% endif %}">Pending Aquisitions</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if potential is defined %}active{% endif %}"
                           id="potential_aquisitions_tab"
                           {# data-toggle="tab" #}
                           href="#{{ path('admin_affiliate_potential', {'id': affiliate.id}) }}"
                           role="tab"
                           aria-controls="potential_aquisitions"
                           aria-selected="{% if potential is defined %}true{% else %}false{% endif %}se">Potential Aquisitions</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if lost is defined %}active{% endif %}"
                           id="{{ path('admin_affiliate_lost', {'id': affiliate.id}) }}"
                           {# data-toggle="tab" #}
                           href="#lost_aquisitions"
                           role="tab"
                           aria-controls="lost_aquisitions"
                           aria-selected="{% if lost is defined %}true{% else %}false{% endif %}">Lost Aquisitions</a>
                    </li>
                </ul>

                <div class="tab-content" id="affiliate_tabs_content">
                    <div class="tab-pane fade {% if overview is defined %}show active{% endif %}"
                         id="overview"
                         role="tabpanel"
                         aria-labelledby="overview_tab">
                        {% if overview is defined %}
                            <div class="row">
                                <div class="col">
                                    <h5 class="my-4">Affiliate Parameters</h5>
                                    <div class="table-responsive-sm mb-5">
                                        <table class="table table-striped">
                                            <tbody>
                                                <tr>
                                                    <td>CPA</td>
                                                    <td>Â£{{ affiliate.cpa }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Charge Model</td>
                                                    <td>{{ affiliate.chargeModel }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Days</td>
                                                    <td>{{ affiliate.days }}</td>
                                                </tr>
                                                {% if affiliate.chargeModel == 'ongoing' %}
                                                    <tr>
                                                        <td>Renewal Days</td>
                                                        <td>{{ affiliate.renewalDays }}</td>
                                                    </tr>
                                                {% endif %}
                                                <tr>
                                                    <td>Campaign Name</td>
                                                    <td>{{ affiliate.campaignName }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Campaign Source</td>
                                                    <td>{{ affiliate.campaignSource }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Lead Source</td>
                                                    <td>{{ affiliate.leadSource }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Lead Source Details</td>
                                                    <td>{{ affiliate.leadSourceDetails }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Promotion</td>
                                                    <td>
                                                        {% if affiliate.promotion %}
                                                            <a href="{{ path('admin_promotion', {'id': affiliate.promotion.id }) }}">{{ affiliate.promotion.name }}</a>
                                                        {% else %}
                                                            No Promotion
                                                        {% endif %}
                                                        <br>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="2">
                                                        <a href="#"
                                                           class="btn btn-primary btn-square btn-sm"
                                                           data-toggle="modal"
                                                           data-target="#promotion_form">Update Promotion <i class="fal fa-pencil fa-fw"></i></a>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col">
                                    <h5 class="my-4">Revision History</h5>
                                    <div class="table-responsive-sm mb-5">
                                        <table class="table table-striped">
                                            <tbody>
                                                {% for note in affiliate.notesList|reverse %}
                                                    <tr>
                                                        <td>{{ note.notes }}</td>
                                                        <td>{{ note.userName }}</td>
                                                        <td>{{ note.date|date('d/m/Y H:i') }}</td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            {# TODO: refactor admin confirm modal to make it not have a variable called policy. #}
                            {% include 'AppBundle::Admin/adminConfirmModalNew.html.twig' with {
                                'route': 'AppBundle:AdminEmployee:affiliatePromotionForm',
                                'policy': affiliate,
                                'id': 'promotion_form',
                                'title': 'Set Promotion',
                                'size': ''
                            } %}
                        {% endif %}
                    </div>
                    <div class="tab-pane fade {% if charges is defined %}show active{% endif %}"
                         id="monthly_charges"
                         role="tabpanel"
                         aria-labelledby="monthly_charges_tab">
                         {% if charges is defined %}

                         {% endif %}
                    </div>
                    <div class="tab-pane fade {% if pending is defined %}show active{% endif %}"
                         id="pending_aquisitions"
                         role="tabpanel"
                         aria-labelledby="pending_aquisitions_tab">
                         {% if pending is defined %}

                         {% endif %}
                    </div>
                    <div class="tab-pane fade {% if potential is defined %}show active{% endif %}"
                         id="potential_aquisitions"
                         role="tabpanel"
                         aria-labelledby="potential_aquisitions_tab">
                         {% if potential is defined %}

                         {% endif %}
                    </div>
                    <div class="tab-pane fade {% if lost is defined %}show active{% endif %}"
                         id="lost_aquisitions"
                         role="tabpanel"
                         aria-labelledby="lost_aquisitions_tab">
                         {% if lost is defined %}

                         {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>
    </section>

    {# Page Modals #}


{% endblock %}

{% block javascriptsPage %}
    <script src="{{ asset('css-js/confirm-modal.js') }}"></script>
{% endblock %}
