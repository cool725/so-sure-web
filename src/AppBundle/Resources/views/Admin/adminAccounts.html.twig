{% extends 'base.html.twig' %}
{% block body %}
<div class="container" style="margin-bottom: 50px">

{{ form_start(form) }}
<div class="row">
    <div class="col-md-7">
        <h1>so-sure Accounts for {{ month }} / {{ year }}</h1>
    </div>
    <div class="col-md-2">
        <div class="form-group">
            {{ form_label(form.month, 'Month') }}
            {{ form_errors(form.month) }}
            {{ form_widget(form.month) }}
        </div>                
    </div>
    <div class="col-md-2">
        <div class="form-group">
            {{ form_label(form.year, 'Year') }}
            {{ form_errors(form.year) }}
            {{ form_widget(form.year) }}
        </div>                
    </div>
    <div class="col-md-1">
        <div class="form-group">
            {{ form_widget(form.submit, {'label': 'View Accounts', 'attr': {'class': 'btn btn-success'}}) }}
        </div>                
    </div>
</div>
{{ form_end(form) }}

<table class="table table-striped">
    <tr class="info">
        <td>Total for month</td>
        <td>£{{ total|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td>Paid in</td>
        <td>£{{ received|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td>Refunded</td>
        <td>£{{ refunded|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td>Total Commissions (so-sure + Afl)</td>
        <td>£{{ totalCommission|number_format(2, '.', ',') }} ( {{ (100 * totalCommission / total) |number_format(1, '.', ',')}}% )</td>
    </tr>
    <tr class="success">
        <td>so-sure Commission</td>
        <td>£{{ coverholderCommission|number_format(2, '.', ',') }} ( {{ (100 * coverholderCommission / total) |number_format(1, '.', ',')}}% )</td>
    </tr>
    <tr class="danger">
        <td>Salva</td>
        <td>£{{ underwriterAmount|number_format(2, '.', ',') }} ( {{ (100 * underwriterAmount / total) |number_format(1, '.', ',')}}% )</td>
    </tr>
    <tr class="danger">
        <td>Afl Commission</td>
        <td>£{{ brokerCommission|number_format(2, '.', ',') }} ( {{ (100 * brokerCommission / total) |number_format(1, '.', ',')}}% )</td>
    </tr>
    <tr>
        <td>Number of Payments Received</td>
        <td>{{ numPayments }}</td>
    </tr>
    <tr>
        <td>Average Payment Amount</td>
        <td>£{{ avgPayment|number_format(2, '.', ',')  }}</td>
    </tr>
    <tr>
        <td>Number of Active Policies (as of end {{ month }} / {{ year }}) <br />
        * <i>May not be very accurate when viewed historically</i></td>
        <td>{{ activePolicies }}</td>
    </tr>
</table>
<h2>Reconciliation Data</h2>
    {% for file in files %}
        <h3>{{ file.filename }}</h3>
        <ul>
            {% for key, value in file.metadata %}
                <li>{{ key }}: {{ value }}</li>
            {% endfor %}
        </ul>
    {% endfor %}
</div>
{% endblock %}