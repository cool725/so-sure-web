{% extends 'base.html.twig' %}

{# Set vars #}
{% set new_stylesheet = 1 %}
{% set new_footer = 1 %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets output='css/*.css'
    '@AppBundle/Resources/public/sass/page/user.scss'%}
    <link rel="stylesheet" href="{{ asset_url }}"> {% endstylesheets %}
{% endblock %}

{% block body %}

    {% include 'AppBundle:User:userNav.html.twig' %}

    <section class="user-homepage--content section--pad">
        <div class="container">

            <h1>My Policies</h1>

            {% for policyItem in user.getDisplayablePoliciesSorted %}
            <div class="row">
                <div class="col-md-6">
                    <h4>{{ policyItem.phone }} <span class="badge">{{ policyItem.status|capitalize }}</span></h4>
                    <p>{{ policyItem.policyNumber }} ({{ policyItem.start|date('dS M Y') }} - {{ policyItem.end|date('dS M Y') }})</p>

                    {# With pic-sure #}
                    <table class="table table-bordered table-mod text-center">
                        <thead>
                            <tr>
                              <td width="20%">pic-sure <i class="fa fa-check text-green" aria-hidden="true"></i></td>
                              <td>Cover</td>
                              <td width="20%">Excess</td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                              <td rowspan="2" valign="center"><img src="{{ cdn_url }}/images/user/pic-sure_validated_stamp.svg" alt="pic-sure valid" width="80px"></td>
                              <td>Accidental damage/breakdown</td>
                              <td>&pound;50</td>
                            </tr>
                            <tr>
                              <td>Theft/loss</td>
                              <td>&pound;70</td>
                            </tr>
                        </tbody>
                    </table>

                    {# Without pic-sure #}
                    <table class="table table-bordered table-mod text-center">
                        <thead>
                            <tr>
                              <td width="20%">pic-sure <i class="fa fa-times text-red" aria-hidden="true"></i></td>
                              <td>Cover</td>
                              <td width="20%">Excess</td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                              <td valign="middle"><img src="{{ cdn_url }}/images/user/pic-sure_non_validated_stamp.svg" alt="pic-sure valid" width="80px"></td>
                              <td>Accidental damage/breakdown/Theft/loss</td>
                              <td>&pound;150</td>
                            </tr>
                        </tbody>
                    </table>

                </div>
                <div class="col-md-6">
                    <ul class="nav nav-pills">
                        {% if policyItem.getPolicyTermsFiles|length > 0 %}
                            <li>
                                <a href="{{ s3DownloadLink(policyItem.getPolicyTermsFiles[0].bucket, policyItem.getPolicyTermsFiles[0].key) }}"
                                class=""><i class="fa fa-download"></i> Policy Terms</a>
                            </li>
                        {% endif %}
                        {% if policyItem.getPolicyScheduleFiles|length > 0 %}
                            <li>
                                <a href="{{ s3DownloadLink(policyItem.getPolicyScheduleFiles[0].bucket, policyItem.getPolicyScheduleFiles[0].key) }}"
                                class=""><i class="fa fa-download"></i> Policy Schedule</a>
                            </li>
                        {% endif %}
                        {% if policyItem.displayRepurchase %}
                            <li>
                                <a href="{{ path('user_repurchase_policy', {'id': policyItem.id }) }}"
                                class=""> Repurchase Policy</a>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
            {% endfor %}

            {% if user.getDisplayableCashbackSorted|length > 0 %}
                <div class="row">
                    <div class="col-md-12">
                        <h2>Cashback</h2>
                    </div>
                </div>
                {% for cashback in user.getDisplayableCashbackSorted %}
                <div class="row">
                    <div class="col-md-6">
                      <h4>{{ cashback.policy.policyNumber }} <span class="badge">{{ cashback.getDisplayableStatus }}</span></h4>
                      <p>Â£{{ cashback.getDisplayableAmount|number_format(2, '.', ',') }}</p>
                    </div>
                    {% if cashback.status == 'missing' or cashback.status == 'failed' %}
                    <div class="col-md-6">
                        <a href="{{ path('user_cashback', {'id': cashback.id }) }}"
                        class="btn btn-primary btn-xs">Add/Update Bank Details</a>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% endif %}
        </div>
    </section>

    <section class="section--pad"></section>

{% endblock %}
