version: 0.2
os: linux
run-as: root
phases:
  install:
    commands:
      - /usr/bin/redis-server --port 6379 &
      - /usr/bin/mongod --dbpath /tmp --quiet --fork --logpath /tmp/mongo.log
      - /var/ops/ansible/create-parameters.sh build
      - /var/ops/scripts/install-vendors.sh -n -u jenkins $CODEBUILD_SRC_DIR test
      - /var/ops/scripts/create-folders.sh -n -u jenkins $CODEBUILD_SRC_DIR test
      - /var/ops/scripts/clear-cache.sh $CODEBUILD_SRC_DIR test
      - /var/ops/scripts/run-encore.sh $CODEBUILD_SRC_DIR test
  build:
    commands:
      - ./build/run-test-functional.sh -l
