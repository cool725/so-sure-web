{% set indent_width = "5%" %}
{% set text_width = "70%" %}
<h4>Premium Income Breakdown</h4>
<table class="table table-striped">
    <tr class="info">
        <td colspan="3">Premium Payments</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Paid in (cards)</td>
        <td>£{{ paymentTotals.judo.received|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Paid in (bacs)</td>
        <td>£{{ paymentTotals.bacs.received|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Paid in (so-sure)</td>
        <td>£{{ paymentTotals.sosure.received|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Premium received in month</strong></td>
        {% set receivedTotal = paymentTotals.judo.received + paymentTotals.bacs.received + paymentTotals.sosure.received %}
        {% if equal_to_two_dp(receiviedTotal, paymentTotals.all.received) %}
        <td><strong>£{{ receivedTotal|number_format(2, '.', ',') }}</strong></td>
        {% else %}
        <td class="bg-danger" title="Expect total received £{{ paymentTotals.all.received|number_format(2, '.', ',') }}"><strong>£{{ receivedTotal|number_format(2, '.', ',') }}</strong></td>
        {% endif %}
    </tr>
    <tr class="info">
        <td colspan="3">Premium Refunds</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Refunded (cards)</td>
        <td>(£{{ (0 - paymentTotals.judo.refunded)|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Chargebacks (cards)</td>
        <td>(£{{ (0 - paymentTotals.chargebacks.all)|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Refunded (bacs)</td>
        <td>(£{{ (0 - paymentTotals.bacs.refunded)|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Refunded (so-sure)</td>
        <td>(£{{ (0 - paymentTotals.sosure.refunded)|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Premium refunds in month</strong></td>
        {% set refundedTotal = paymentTotals.judo.refunded + paymentTotals.chargebacks.all + paymentTotals.bacs.refunded + paymentTotals.sosure.refunded %}
        {% if equal_to_two_dp(refundedTotal, paymentTotals.all.refunded - paymentTotals.chargebacks.received) %}
        <td><strong>(£{{ (0 - paymentTotals.all.refunded)|number_format(2, '.', ',') }})</strong></td>
        {% else %}
        <td class="bg-danger" title="Expect total received £{{ paymentTotals.all.refunded - paymentTotals.chargebacks.received|number_format(2, '.', ',') }}"><strong>(£{{ (0 - refundedTotal)|number_format(2, '.', ',') }})</strong></td>
        {% endif %}
    </tr>
    <tr>
        <td colspan="3">&nbsp;</td>
    </tr>
    <tr>
        <td colspan="2" width="{{ text_width }}">Debt Collection Fees</td>
        <td>(£{{ (0 - paymentTotals.all.fees)|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td colspan="2"><strong>Net monthly premium received</strong></td>
        <td><strong>£{{ (paymentTotals.all.total)|number_format(2, '.', ',') }}</strong></td>
    </tr>
</table>
<h4>Reward Pot</h4>
<table class="table table-striped">
    <tr class="info">
        <td colspan="3">End of Year Reward Pot Incurred</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">End of Policy Year Reward Pot Incurred</td>
        <td>£{{ (0 - paymentTotals.potReward.refunded)|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Reward Pot Refund Due To Settled Claim Since Policy Year End</td>
        <td>(£{{ paymentTotals.potReward.received|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Net Reward Pot Incurred</strong></td>
        <td><strong>£{{ (0 - paymentTotals.potReward.total)|number_format(2, '.', ',') }}</strong></td>
    </tr>
    <tr class="info">
        <td colspan="3">End of Year Reward Pot Incurred (Cashback)</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">End of Policy Year Reward Pot Incurred (Cashback)</td>
        <td>£{{ (0 - paymentTotals.potRewardCashback.refunded)|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Reward Pot Refund Due To Settled Claim Since Policy Year End (Cashback)</td>
        <td>(£{{ paymentTotals.potRewardCashback.received|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Net Reward Pot Incurred (Cashback)</strong></td>
        <td><strong>£{{ (0 - paymentTotals.potRewardCashback.total)|number_format(2, '.', ',') }}</strong></td>
    </tr>
    <tr class="info">
        <td colspan="3">End of Year Reward Pot Incurred (Renewal Discount)</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">End of Policy Year Reward Pot Incurred (Renewal Discount)</td>
        <td>£{{ (0 - paymentTotals.potRewardDiscount.refunded)|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Reward Pot Refund Due To Settled Claim Since Policy Year End (Renewal Discount)</td>
        <td>(£{{ paymentTotals.potRewardDiscount.received|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Net Reward Pot Incurred (Renewal Discount)</strong></td>
        <td><strong>£{{ (0 - paymentTotals.potRewardDiscount.total)|number_format(2, '.', ',') }}</strong></td>
    </tr>
    <tr class="info">
        <td colspan="3">End of Year Reward Pot Incurred by so-sure for marketing</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">End of Policy Year Reward Pot Incurred</td>
        <td>£{{ (0 - paymentTotals.sosurePotReward.refunded)|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Reward Pot Refund Due To Settled Claim Since Policy Year End</td>
        <td>(£{{ paymentTotals.sosurePotReward.received|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Net Reward Pot Incurred by so-sure for marketing</strong></td>
        <td><strong>£{{ (0 - paymentTotals.sosurePotReward.total)|number_format(2, '.', ',') }}</strong></td>
    </tr>
    <tr class="info">
        <td colspan="3">End of Year Reward Pot Incurred by so-sure for marketing (Cashback)</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">End of Policy Year Reward Pot Incurred (Cashback)</td>
        <td>£{{ (0 - paymentTotals.sosurePotRewardCashback.refunded)|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Reward Pot Refund Due To Settled Claim Since Policy Year End (Cashback)</td>
        <td>(£{{ paymentTotals.sosurePotRewardCashback.received|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Net Reward Pot Incurred by so-sure for marketing (Cashback)</strong></td>
        <td><strong>£{{ (0 - paymentTotals.sosurePotRewardCashback.total)|number_format(2, '.', ',') }}</strong></td>
    </tr>
    <tr class="info">
        <td colspan="3">End of Year Reward Pot Incurred by so-sure for marketing (Renewal Discount)</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">End of Policy Year Reward Pot Incurred (Renewal Discount)</td>
        <td>£{{ (0 - paymentTotals.sosurePotRewardDiscount.refunded)|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Reward Pot Refund Due To Settled Claim Since Policy Year End (Renewal Discount)</td>
        <td>(£{{ paymentTotals.sosurePotRewardDiscount.received|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Net Reward Pot Incurred by so-sure for marketing (Renewal Discount)</strong></td>
        <td><strong>£{{ (0 - paymentTotals.sosurePotRewardDiscount.total)|number_format(2, '.', ',') }}</strong></td>
    </tr>
    <tr class="info">
        <td colspan="3">Reward Pot Paid To Customers</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Lump Sum Cashback To Customers</td>
        <td>£{{ paymentTotals.totalCashback|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Net Reward Pot Paid To Customers</strong></td>
        <td><strong>£{{ paymentTotals.totalCashback|number_format(2, '.', ',') }}</strong></td>
    </tr>
    <tr class="info">
        <td colspan="3">Renewal Discount Refund</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Renewal Discount Refund To Customers due to Policy Cancellation</td>
        <td>£{{ (0 - paymentTotals.policyDiscountRefunds.total)|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Net Renewal Discount Refund</strong></td>
        <td><strong>£{{ (0 - paymentTotals.policyDiscountRefunds.total)|number_format(2, '.', ',') }}</strong></td>
    </tr>
    {#
    <tr class="info">
        <td colspan="3">Client Account</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Opening Balance in Client Account</td>
        <td></td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Net Reward Pot Paid In</td>
        <td><strong>£{{ paymentTotals.potReward.total|number_format(2, '.', ',') }}</strong></td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Net Reward Pot Paid Out</td>
        <td><strong>£</strong></td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Closing Balance in Client Account</strong></td>
        <td></td>
    </tr>
    #}
</table>
<h4>Monthly Distributions by Source</h4>
<table class="table table-striped">
    <tr class="info">
        <td colspan="3">Premium</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Salva</td>
        <td>£{{ paymentTotals.all.totalUnderwriter|number_format(2, '.', ',') }} ( {{ paymentTotals.all.totalUnderwriterPercent |number_format(1, '.', ',')}}% )</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">so-sure Coverholder Fee</td>
        <td>£{{ paymentTotals.all.coverholderCommission|number_format(2, '.', ',') }} ( {{ paymentTotals.all.coverholderCommissionPercent |number_format(1, '.', ',')}}% )</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">AFL Broker Fee</td>
        <td>£{{ paymentTotals.all.brokerCommission|number_format(2, '.', ',') }} ( {{ paymentTotals.all.brokerCommissionPercent |number_format(1, '.', ',')}}% )</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Total premium distributions</strong></td>
        <td><strong>£{{ (paymentTotals.all.totalUnderwriter + paymentTotals.all.totalCommission)|number_format(2, '.', ',') }}</strong></td>
    </tr>
</table>
<h4>Net Distributions of Each Party</h4>
<table class="table table-striped">
    <tr class="info">
        <td colspan="3">Salva Transfer</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Premium Distribution</td>
        <td>£{{ paymentTotals.all.totalUnderwriter|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Net Reward Pot Incurred (Cashback)</td>
        <td>(£{{ (0 - paymentTotals.potRewardCashback.total)|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Net Reward Pot Incurred by so-sure for marketing (Renewal Discount)</td>
        <td>£{{ (0 - paymentTotals.sosurePotRewardDiscount.total)|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Net Renewal Discount Refund</td>
        <td>(£{{ 0 - paymentTotals.policyDiscountRefunds.total|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Net transfer to Salva</strong></td>
        <td><strong>£{{ (paymentTotals.all.totalUnderwriter + paymentTotals.potRewardCashback.total + (0 - paymentTotals.sosurePotRewardDiscount.total) + paymentTotals.policyDiscountRefunds.total)|number_format(2, '.', ',') }}</strong></td>
    </tr>
    <tr class="info">
        <td colspan="3">so-sure Transfer</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">so-sure Coverholder fee</td>
        <td>£{{ paymentTotals.all.coverholderCommission|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">so-sure (marketing) Premium Payments</td>
        <td>(£{{ paymentTotals.sosure.total|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Net Reward Pot Incurred by so-sure for marketing (Cashback)</td>
        <td>(£{{ (0 - paymentTotals.sosurePotRewardCashback.total)|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Net Reward Pot Incurred by so-sure for marketing (Renewal Discount)</td>
        <td>(£{{ (0 - paymentTotals.sosurePotRewardDiscount.total)|number_format(2, '.', ',') }})</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Net transfer to so-sure</strong></td>
        <td><strong>£{{ (paymentTotals.all.coverholderCommission - paymentTotals.sosure.total + paymentTotals.sosurePotRewardCashback.total + paymentTotals.sosurePotRewardDiscount.total)|number_format(2, '.', ',') }}</strong></td>
    </tr>
    <tr class="info">
        <td colspan="3">AFL Transfer</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">AFL Broker Fee</td>
        <td>£{{ paymentTotals.all.brokerCommission|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}"><strong>Net transfer to AFL</strong></td>
        <td><strong>£{{ paymentTotals.all.brokerCommission|number_format(2, '.', ',') }}</strong></td>
    </tr>
</table>
<h4>Details</h4>
<table class="table table-striped">
    <tr class="info">
        <td colspan="3">Payments Received</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Judo</td>
        <td>{{ paymentTotals.judo.numReceived }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Bacs</td>
        <td>{{ paymentTotals.bacs.numReceived }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">so-sure (marketing)</td>
        <td>{{ paymentTotals.sosure.numReceived }}</td>
    </tr>
    <tr class="info">
        <td colspan="3">Payments Refunded</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Judo</td>
        <td>{{ paymentTotals.judo.numRefunded }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">Bacs</td>
        <td>{{ paymentTotals.bacs.numRefunded }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td width="{{ text_width }}">so-sure (marketing)</td>
        <td>{{ paymentTotals.sosure.numRefunded }}</td>
    </tr>
    <tr class="info">
        <td colspan="3">Policy Stats</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td>Average Payment Amount</td>
        <td>{% if paymentTotals.all.avgPayment %}£{{ paymentTotals.all.avgPayment|number_format(2, '.', ',')  }}{% else %}n/a{% endif %}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td>Number of Active Policies (as of end {{ month }} / {{ year }})</td>
        <td>{{ activePolicies }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td>Number of Active Policies w/Reward Pot Discount (as of end {{ month }} / {{ year }})</td>
        <td>{{ activePoliciesWithDiscount }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td>Reward Pot Liability <br /><i>Active Policies not ending in month w/Reward Pot</i></td>
        <td>£{{ (rewardPotLiability - rewardPromoPotLiability)|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td>Reward Pot Liability for so-sure (marketing) <br /><i>Active Policies not ending in month w/Reward Pot</i></td>
        <td>£{{ rewardPromoPotLiability|number_format(2, '.', ',') }}</td>
    </tr>
    <tr>
        <td width="{{ indent_width }}"></td>
        <td>Annual Run Rate Premium</td>
        <td>£{{ paymentTotals.totalRunRate|number_format(0, '.', ',') }}</td>
    </tr>
</table>
