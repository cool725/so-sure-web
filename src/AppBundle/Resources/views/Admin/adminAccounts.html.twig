{% extends 'base.html.twig' %}
{% block body %}
<div class="container" style="margin-bottom: 50px">

{{ form_start(yearMonthForm) }}
<div class="row">
    <div class="col-md-6">
        <h1>so-sure Accounts for {{ month }} / {{ year }}</h1>
    </div>
    <div class="col-md-2">
        <div class="form-group" style="padding-top: 25px;">
            {{ form_label(yearMonthForm.month, 'Month') }}
            {{ form_errors(yearMonthForm.month) }}
            {{ form_widget(yearMonthForm.month) }}
        </div>                
    </div>
    <div class="col-md-2">
        <div class="form-group" style="padding-top: 25px;">
            {{ form_label(yearMonthForm.year, 'Year') }}
            {{ form_errors(yearMonthForm.year) }}
            {{ form_widget(yearMonthForm.year) }}
        </div>                
    </div>
    <div class="col-md-2">
        <div class="form-group" style="padding-top: 15px;">
            {{ form_widget(yearMonthForm.submit, {'label': 'View Accounts', 'attr': {'class': 'btn btn-success'}}) }}&nbsp;
            <a target="_blank" href="{{ path('admin_accounts_print', {'year': year, 'month': month}) }}"><i class="fa fa-print"></i></a>
        </div>                
    </div>
</div>
{{ form_end(yearMonthForm) }}
<h4>Note that # of policies may not be accurate when viewed historically until <a href="https://app.clubhouse.io/sosure/story/787/past-reporting">ch787</a> is complete.</h4>

{% include 'AppBundle:Admin:adminAccountsData.html.twig' %}

{{ form_start(judoForm) }}
<div class="row">
    <div class="col-md-7">
        <h2>Reconciliation Data</h2>
    </div>
    <div class="col-md-3">
        <div class="form-group">
            {{ form_label(judoForm.file, 'File') }}
            {{ form_errors(judoForm.file) }}
            {{ form_widget(judoForm.file) }}
        </div>                
    </div>
    <div class="col-md-1">
        <div class="form-group">
            {{ form_widget(judoForm.upload, {'label': 'Upload', 'attr': {'class': 'btn btn-success'}}) }}
        </div>                
    </div>
</div>
{{ form_end(judoForm) }}

    {% for file in files %}
        {% if file.fileType == 'SalvaPaymentFile' or file.fileType == 'SalvaPolicyFile' or file.fileType == 'JudoFile' %}
        {% set filename = file.filename|split('.') %}
        {% set file_dates = filename[0]|split('-') %}
        {% set file_date = file_dates[file_dates|length - 1] %}
        <h3>{{ file.filename }} [From {{ file_date|date }}]</h3>
        <ul>
            {% for key, value in file.metadata %}
                <li>{{ key }}: {{ value }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    {% endfor %}
    
</div>
{% endblock %}